---
title: "Final Project Code"
output: html_document
date: "2024-05-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Exploration

```{r}

df =  read.csv("Survey.csv")
summary(df)

```
  
```{r}
library(faraway) 
library(ggplot2) 

ggplot(df,aes(x=Age))+
geom_histogram()
```

## Plots


```{r}
df$diffinsleeptime = df$Avg.sleep.time - df$last.night.sleep.time

ggplot(df,aes(x=Age,y=Avg.sleep.time))+
  geom_point()
ggplot(df,aes(x=Avg.hours.exercise,y=Avg.sleep.time))+
  geom_point()
boxplot(Avg.sleep.time ~ Game.freq, data = df, main = "(b) Vertical")



```


```{r}

colnames(df)


variables_to_keep <- c("last.night.sleep.time", "Reaction.time", "Awake.hours", "Noise.level", "Avg.hours.exercise","Avg.sleep.time","Age")

dfnumeric = subset(df, select=variables_to_keep)
pairs(dfnumeric)

```
```{r}
cor(dfnumeric)
```
```{r}
df$diffinsleeptime = df$Avg.sleep.time - df$last.night.sleep.time
colnames(df)

```
```{r}
library(tidyverse)
df %>% count(Input.device)
```

## combining
```{r}
# library(tidyverse)
# df %>% count(Game.freq)
# df %>% count(Sport.freq)
# df %>% count(Caffein.intake)
# 
# df <- df %>%
# mutate(Game.3 = case_when(
# Game.freq %in% c("Several times a week", "Daily")~ "often",
# Game.freq %in% c("Several times a month", "Once a week") ~ "sometimes",
# Game.freq %in% c("Rarely", "Never")~ "rarely"),
# Game.3 = factor(Game.3, levels=c("often", "sometimes", "rarely")))

# df <- df %>%
# mutate(Sport.3 = case_when(
# Sport.freq %in% c("Several times a week", "Daily")~ "often",
# Sport.freq %in% c("Several times a month", "Once a week") ~ "sometimes",
# Sport.freq %in% c("Rarely", "Never")~ "rarely"),
# Sport.3 = factor(Sport.3, levels=c("often", "sometimes", "rarely")))
# df

```

## more plots
```{r}
library(ggplot2)
ggplot(df,aes(x=Age,y=Reaction.time))+
  geom_point()
ggplot(df,aes(x=Avg.hours.exercise,y=Reaction.time))+
  geom_point()
ggplot(df,aes(x=Avg.sleep.time,y=Reaction.time))+
  geom_point()
boxplot(Reaction.time ~ Input.device, data = df, main = "(b) Vertical")

```
## Model Building
```{r}
library(lmtest)
model1 = lm(Reaction.time~ Avg.hours.exercise+ Avg.sleep.time+Age+Input.device,data=df)
summary(model1)

```
### Model 1 diagnostics
```{r}
par(mfrow=c(2,2))
plot(model1)
```
```{r}
###high influence
n=141
p=8
lev=influence(model1)$hat
lev[lev>2*p/n]
```
```{r}
plot(lev)
abline(h=2*p/n)
```
```{r}
halfnorm(lev,4, labs=row.names(df),ylab="leverages")
```
Row 112 may be very problematic and could be removed
```{r}
###outliers
jack=rstudent(model1)
qt(.05/(2*n),141-1-8)
```
```{r}
##there appears to be one outlier at point 91, we should remove it and refit the model
### should you actually though?
sort(abs(jack),decreasing=TRUE)[1:8]
```


```{r}
## there do not appear to be any highly influential observations????
### what happened here
cook=cooks.distance(model1)
max(cook)
```
```{r}
halfnorm(cook,labs=row.names(df),ylab="Cook's distances")
```

```{r}
shapiro.test(model1$residuals)
```
H0: The normality assumption met

H1: The normality assumption is not met


Since p-value is 1.687x10^-07 we have enough statistically significant evidence to say that the normality assumption is not met. Thus we reject the null hypothesis at alpha=.05 level and conclude we do not meet the normality assumption.

```{r}
bptest(model1)
```
H0: We have constant variance

H1: We do not have constant variance

Since the p-value is .1644 we do not have enough statistically significant evidence to say that the constant variance assumption is not met. Thus we fail to reject the null hypothesis at alpha=.05 level

## Variable selection backwards stepwise
```{r}
library(olsrr)
best_backward_model<- ols_step_backward_p(model1, p_value = 0.15, details = FALSE)
best_backward_model
```
The reduced model has a better adj R^2 than the full model
## Best AIC model
```{r}
# library(stats)
# library(leaps)
# ## Warning: package ’leaps’ was built under R version 4.3.3
# b = regsubsets(Avg.sleep.time ~ Age + Game.freq + Avg.hours.exercise, data = df)
# rs = summary(b)
# rs$which
```

```{r}
# n=dim(df)[1]
# msize = 1:7
# Aic= n*log(rs$rss/n)+2*msize
# Aic
```

```{r}
# plot(msize, Aic, xlab="Number of params", ylab="AIC")
```


## Interaction model

```{r}
### do you need to do diagnostics?
model2 = lm(Reaction.time~ Avg.hours.exercise+ Age+Avg.sleep.time*Input.device,data=df)
summary(model2)
```

## Model comparison

```{r}
anova(model1, model2)
```
The interaction term between sleep time and input device is significant and we prefer the interaction term model
```{r}
anova(model1)
```
```{r}
anova(model2)
```




